<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calvin's Website</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="hero">
      <h1>Welcome to Calvin's Website!</h1>
      <section class="game-section" aria-label="Slice-N-Dice 3000">
        <div class="game-header">
          <h2>Slice-N-Dice 3000</h2>
          <p>
            Click or press and hold to lift the butter knife. Slice butter,
            jelly, and apples for points, but avoid the toasters and the ground.
          </p>
        </div>
        <div class="game-shell">
          <canvas id="game-canvas" width="720" height="420"></canvas>
          <div class="game-stats" aria-live="polite">
            <span id="score">Score: 0</span>
            <span id="status">Keep slicing!</span>
          </div>
        </div>
      </section>
    </main>
    <script>
      const canvas = document.getElementById("game-canvas");
      const ctx = canvas.getContext("2d");
      const scoreLabel = document.getElementById("score");
      const statusLabel = document.getElementById("status");

      ctx.imageSmoothingEnabled = false;

      const groundHeight = 70;
      const knife = {
        x: 120,
        y: 120,
        width: 46,
        height: 12,
        vx: 0,
        vy: 0,
      };

      const items = [];
      let score = 0;
      let scrollOffset = 0;
      let lastSpawn = 0;
      let lastTime = performance.now();
      let isLifting = false;

      const itemTypes = [
        {
          name: "butter",
          color: "#f8e16c",
          points: 10,
          width: 34,
          height: 22,
        },
        {
          name: "jelly",
          color: "#c34b7a",
          points: 12,
          width: 28,
          height: 28,
        },
        {
          name: "apple",
          color: "#e24b3b",
          points: 15,
          width: 26,
          height: 26,
        },
        {
          name: "toaster",
          color: "#7d7b7f",
          points: -20,
          width: 36,
          height: 26,
        },
      ];

      const spawnItem = () => {
        const type = itemTypes[Math.floor(Math.random() * itemTypes.length)];
        const minY = 60;
        const maxY = canvas.height - groundHeight - type.height - 20;
        items.push({
          ...type,
          x: canvas.width + 40,
          y: Math.random() * (maxY - minY) + minY,
          vx: -2.6 - Math.random() * 1.8,
        });
      };

      const resetKnife = () => {
        knife.x = 120;
        knife.y = 120;
        knife.vx = 0;
        knife.vy = 0;
      };

      const updateScore = (delta, message) => {
        score += delta;
        scoreLabel.textContent = `Score: ${score}`;
        if (message) {
          statusLabel.textContent = message;
        }
      };

      const checkCollision = (a, b) => {
        return (
          a.x < b.x + b.width &&
          a.x + a.width > b.x &&
          a.y < b.y + b.height &&
          a.y + a.height > b.y
        );
      };

      const update = (timestamp) => {
        const delta = Math.min(32, timestamp - lastTime);
        lastTime = timestamp;
        lastSpawn += delta;
        if (lastSpawn > 900) {
          spawnItem();
          lastSpawn = 0;
        }

        const lift = 0.22 * delta;
        const maxSpeed = 3.8;
        knife.vx *= 0.92;

        if (isLifting) {
          knife.vy -= lift;
        }

        knife.vx = Math.max(-maxSpeed, Math.min(maxSpeed, knife.vx));
        knife.vy = Math.max(-maxSpeed * 1.4, Math.min(maxSpeed * 1.4, knife.vy));
        knife.vy += 0.07 * delta;
        knife.x = Math.max(40, Math.min(canvas.width - 80, knife.x + knife.vx));
        knife.y += knife.vy;

        const groundTop = canvas.height - groundHeight;
        if (knife.y + knife.height > groundTop) {
          knife.y = groundTop - knife.height;
          knife.vy = -4;
          updateScore(-10, "Ouch! The ground bites.");
        }
        if (knife.y < 20) {
          knife.y = 20;
          knife.vy = 1.2;
        }

        items.forEach((item) => {
          item.x += item.vx;
        });

        for (let i = items.length - 1; i >= 0; i -= 1) {
          const item = items[i];
          if (item.x + item.width < -40) {
            items.splice(i, 1);
            continue;
          }
          if (checkCollision(knife, item)) {
            if (item.name === "toaster") {
              updateScore(item.points, "ZAP! Toasted.");
            } else {
              updateScore(item.points, `Sliced ${item.name}!`);
            }
            items.splice(i, 1);
          }
        }

        scrollOffset = (scrollOffset + 1.2) % 24;
      };

      const drawPixelRect = (x, y, width, height, color) => {
        ctx.fillStyle = color;
        ctx.fillRect(Math.round(x), Math.round(y), width, height);
      };

      const shadeColor = (hex, amount) => {
        const normalized = hex.replace("#", "");
        const num = parseInt(normalized, 16);
        const r = Math.min(255, Math.max(0, (num >> 16) + amount));
        const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00ff) + amount));
        const b = Math.min(255, Math.max(0, (num & 0x0000ff) + amount));
        return `#${(r << 16 | g << 8 | b).toString(16).padStart(6, "0")}`;
      };

      const draw3DBox = (x, y, width, height, color, depth = 8) => {
        const top = shadeColor(color, 24);
        const side = shadeColor(color, -22);
        drawPixelRect(x + depth, y - depth, width, depth, top);
        drawPixelRect(x + width, y - depth, depth, height + depth, side);
        drawPixelRect(x, y, width, height, color);
      };

      const drawBackground = () => {
        const sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
        sky.addColorStop(0, "#9fd7ff");
        sky.addColorStop(1, "#6bb4ff");
        ctx.fillStyle = sky;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < 6; i += 1) {
          const cloudX = (i * 140 + scrollOffset * 0.3) % (canvas.width + 120) - 60;
          const cloudY = 40 + (i % 3) * 28;
          drawPixelRect(cloudX, cloudY, 60, 18, "#e6f5ff");
          drawPixelRect(cloudX + 18, cloudY - 10, 36, 12, "#e6f5ff");
        }

        const groundTop = canvas.height - groundHeight;
        draw3DBox(0, groundTop + 6, canvas.width, 26, "#4faa4f", 10);
        draw3DBox(0, groundTop + 32, canvas.width, groundHeight - 26, "#7d4f2c", 10);

        for (let x = -24; x < canvas.width + 24; x += 24) {
          drawPixelRect(x - scrollOffset, groundTop + 4, 12, 8, "#5ccc58");
          drawPixelRect(x - scrollOffset, groundTop + 32, 16, 6, "#8c5a35");
        }
      };

      const drawKnife = () => {
        drawPixelRect(knife.x + 6, knife.y + knife.height + 8, knife.width, 6, "rgba(0,0,0,0.2)");
        draw3DBox(knife.x, knife.y, knife.width, knife.height, "#f2efe9", 6);
        draw3DBox(knife.x + knife.width - 16, knife.y - 6, 16, 6, "#d4b48c", 4);
        drawPixelRect(knife.x + knife.width - 10, knife.y + 2, 6, 6, "#ba8d5b");
      };

      const drawItems = () => {
        items.forEach((item) => {
          drawPixelRect(item.x + 6, item.y + item.height + 8, item.width, 6, "rgba(0,0,0,0.18)");
          draw3DBox(item.x, item.y, item.width, item.height, item.color, 6);
          if (item.name === "jelly") {
            drawPixelRect(item.x + 6, item.y + 8, 16, 12, "#f39ac3");
          }
          if (item.name === "apple") {
            drawPixelRect(item.x + 8, item.y - 6, 8, 6, "#5a9c4b");
          }
          if (item.name === "toaster") {
            drawPixelRect(item.x + 6, item.y + 6, 10, 12, "#a8a4a9");
            drawPixelRect(item.x + 20, item.y + 6, 10, 12, "#a8a4a9");
          }
        });
      };

      const draw = () => {
        drawBackground();
        drawItems();
        drawKnife();
      };

      const loop = (timestamp) => {
        update(timestamp);
        draw();
        requestAnimationFrame(loop);
      };

      const startLift = (event) => {
        event.preventDefault();
        isLifting = true;
      };
      const stopLift = () => {
        isLifting = false;
      };

      canvas.addEventListener("pointerdown", startLift);
      canvas.addEventListener("pointerup", stopLift);
      canvas.addEventListener("pointerleave", stopLift);
      canvas.addEventListener("pointercancel", stopLift);
      canvas.addEventListener("contextmenu", (event) => event.preventDefault());
      window.addEventListener("blur", stopLift);

      resetKnife();
      requestAnimationFrame(loop);
    </script>
  </body>
</html>
